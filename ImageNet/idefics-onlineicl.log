nohup: ignoring input
/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/torchvision/datapoints/__init__.py:12: UserWarning: The torchvision.datapoints and torchvision.transforms.v2 namespaces are still Beta. While we do not expect major breaking changes, some APIs may still change according to user feedback. Please submit any feedback you may have in this issue: https://github.com/pytorch/vision/issues/6753, and you can also check out https://github.com/pytorch/vision/issues/7319 to learn more about the APIs that we suspect might involve future changes. You can silence this warning by calling torchvision.disable_beta_transforms_warning().
  warnings.warn(_BETA_TRANSFORMS_WARNING)
/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/torchvision/transforms/v2/__init__.py:54: UserWarning: The torchvision.datapoints and torchvision.transforms.v2 namespaces are still Beta. While we do not expect major breaking changes, some APIs may still change according to user feedback. Please submit any feedback you may have in this issue: https://github.com/pytorch/vision/issues/6753, and you can also check out https://github.com/pytorch/vision/issues/7319 to learn more about the APIs that we suspect might involve future changes. You can silence this warning by calling torchvision.disable_beta_transforms_warning().
  warnings.warn(_BETA_TRANSFORMS_WARNING)
Loading checkpoint shards:   0%|          | 0/7 [00:00<?, ?it/s]Loading checkpoint shards:  14%|█▍        | 1/7 [00:01<00:06,  1.01s/it]Loading checkpoint shards:  29%|██▊       | 2/7 [00:01<00:04,  1.02it/s]Loading checkpoint shards:  43%|████▎     | 3/7 [00:02<00:03,  1.04it/s]Loading checkpoint shards:  57%|█████▋    | 4/7 [00:03<00:02,  1.04it/s]Loading checkpoint shards:  71%|███████▏  | 5/7 [00:04<00:01,  1.06it/s]Loading checkpoint shards:  86%|████████▌ | 6/7 [00:05<00:00,  1.09it/s]Loading checkpoint shards: 100%|██████████| 7/7 [00:06<00:00,  1.15it/s]Loading checkpoint shards: 100%|██████████| 7/7 [00:06<00:00,  1.09it/s]
load clip successfully...
Loaded class indices from ./imagenet_class_indices.pkl
self.args.catergory_num:100
len of self.all_class_names:100
get memory bank and sample pool ...
get samples for each class:   0%|          | 0/100 [00:00<?, ?it/s]get samples for each class:   1%|          | 1/100 [00:00<00:35,  2.80it/s]get samples for each class:   2%|▏         | 2/100 [00:00<00:34,  2.86it/s]get samples for each class:   3%|▎         | 3/100 [00:00<00:29,  3.24it/s]get samples for each class:   4%|▍         | 4/100 [00:01<00:27,  3.45it/s]get samples for each class:   5%|▌         | 5/100 [00:01<00:29,  3.26it/s]get samples for each class:   6%|▌         | 6/100 [00:01<00:30,  3.10it/s]get samples for each class:   7%|▋         | 7/100 [00:02<00:32,  2.89it/s]get samples for each class:   8%|▊         | 8/100 [00:02<00:33,  2.75it/s]get samples for each class:   9%|▉         | 9/100 [00:03<00:33,  2.73it/s]get samples for each class:  10%|█         | 10/100 [00:03<00:33,  2.67it/s]get samples for each class:  11%|█         | 11/100 [00:03<00:31,  2.85it/s]get samples for each class:  12%|█▏        | 12/100 [00:04<00:29,  3.01it/s]get samples for each class:  13%|█▎        | 13/100 [00:04<00:28,  3.10it/s]get samples for each class:  14%|█▍        | 14/100 [00:04<00:27,  3.14it/s]get samples for each class:  15%|█▌        | 15/100 [00:04<00:27,  3.13it/s]get samples for each class:  16%|█▌        | 16/100 [00:05<00:26,  3.12it/s]get samples for each class:  17%|█▋        | 17/100 [00:05<00:25,  3.22it/s]get samples for each class:  18%|█▊        | 18/100 [00:05<00:25,  3.16it/s]get samples for each class:  19%|█▉        | 19/100 [00:06<00:26,  3.10it/s]get samples for each class:  20%|██        | 20/100 [00:06<00:25,  3.17it/s]get samples for each class:  21%|██        | 21/100 [00:06<00:24,  3.20it/s]get samples for each class:  22%|██▏       | 22/100 [00:07<00:23,  3.29it/s]get samples for each class:  23%|██▎       | 23/100 [00:07<00:23,  3.28it/s]get samples for each class:  24%|██▍       | 24/100 [00:07<00:23,  3.21it/s]get samples for each class:  25%|██▌       | 25/100 [00:08<00:23,  3.15it/s]get samples for each class:  26%|██▌       | 26/100 [00:08<00:23,  3.09it/s]get samples for each class:  27%|██▋       | 27/100 [00:08<00:22,  3.24it/s]get samples for each class:  28%|██▊       | 28/100 [00:09<00:22,  3.17it/s]get samples for each class:  29%|██▉       | 29/100 [00:09<00:21,  3.26it/s]get samples for each class:  30%|███       | 30/100 [00:09<00:19,  3.63it/s]get samples for each class:  31%|███       | 31/100 [00:09<00:20,  3.32it/s]get samples for each class:  32%|███▏      | 32/100 [00:10<00:21,  3.16it/s]get samples for each class:  33%|███▎      | 33/100 [00:10<00:22,  3.04it/s]get samples for each class:  34%|███▍      | 34/100 [00:10<00:21,  3.10it/s]get samples for each class:  35%|███▌      | 35/100 [00:11<00:21,  3.06it/s]get samples for each class:  36%|███▌      | 36/100 [00:11<00:22,  2.91it/s]get samples for each class:  37%|███▋      | 37/100 [00:11<00:21,  2.96it/s]get samples for each class:  38%|███▊      | 38/100 [00:12<00:27,  2.29it/s]get samples for each class:  39%|███▉      | 39/100 [00:12<00:23,  2.56it/s]get samples for each class:  40%|████      | 40/100 [00:13<00:23,  2.59it/s]get samples for each class:  41%|████      | 41/100 [00:13<00:21,  2.72it/s]get samples for each class:  42%|████▏     | 42/100 [00:13<00:20,  2.86it/s]get samples for each class:  43%|████▎     | 43/100 [00:14<00:19,  2.93it/s]get samples for each class:  44%|████▍     | 44/100 [00:14<00:17,  3.17it/s]get samples for each class:  45%|████▌     | 45/100 [00:14<00:17,  3.15it/s]get samples for each class:  46%|████▌     | 46/100 [00:15<00:17,  3.06it/s]get samples for each class:  47%|████▋     | 47/100 [00:15<00:17,  3.07it/s]get samples for each class:  48%|████▊     | 48/100 [00:15<00:16,  3.20it/s]get samples for each class:  49%|████▉     | 49/100 [00:16<00:16,  3.05it/s]get samples for each class:  50%|█████     | 50/100 [00:16<00:17,  2.86it/s]get samples for each class:  51%|█████     | 51/100 [00:16<00:17,  2.79it/s]get samples for each class:  52%|█████▏    | 52/100 [00:17<00:16,  2.98it/s]get samples for each class:  53%|█████▎    | 53/100 [00:17<00:16,  2.91it/s]get samples for each class:  54%|█████▍    | 54/100 [00:18<00:17,  2.60it/s]get samples for each class:  55%|█████▌    | 55/100 [00:18<00:17,  2.57it/s]get samples for each class:  56%|█████▌    | 56/100 [00:18<00:16,  2.63it/s]get samples for each class:  57%|█████▋    | 57/100 [00:19<00:15,  2.74it/s]get samples for each class:  58%|█████▊    | 58/100 [00:19<00:16,  2.62it/s]get samples for each class:  59%|█████▉    | 59/100 [00:19<00:15,  2.62it/s]get samples for each class:  60%|██████    | 60/100 [00:20<00:13,  2.97it/s]get samples for each class:  61%|██████    | 61/100 [00:20<00:12,  3.05it/s]get samples for each class:  62%|██████▏   | 62/100 [00:20<00:13,  2.90it/s]get samples for each class:  63%|██████▎   | 63/100 [00:21<00:13,  2.83it/s]get samples for each class:  64%|██████▍   | 64/100 [00:21<00:11,  3.12it/s]get samples for each class:  65%|██████▌   | 65/100 [00:22<00:13,  2.60it/s]get samples for each class:  66%|██████▌   | 66/100 [00:22<00:12,  2.76it/s]get samples for each class:  67%|██████▋   | 67/100 [00:22<00:11,  2.95it/s]get samples for each class:  68%|██████▊   | 68/100 [00:22<00:11,  2.83it/s]get samples for each class:  69%|██████▉   | 69/100 [00:23<00:10,  3.06it/s]get samples for each class:  70%|███████   | 70/100 [00:23<00:10,  2.99it/s]get samples for each class:  71%|███████   | 71/100 [00:23<00:09,  3.03it/s]get samples for each class:  72%|███████▏  | 72/100 [00:24<00:09,  3.07it/s]get samples for each class:  73%|███████▎  | 73/100 [00:24<00:08,  3.12it/s]get samples for each class:  74%|███████▍  | 74/100 [00:24<00:07,  3.35it/s]get samples for each class:  75%|███████▌  | 75/100 [00:25<00:07,  3.21it/s]get samples for each class:  76%|███████▌  | 76/100 [00:25<00:07,  3.29it/s]get samples for each class:  77%|███████▋  | 77/100 [00:25<00:07,  3.15it/s]get samples for each class:  78%|███████▊  | 78/100 [00:26<00:06,  3.17it/s]get samples for each class:  79%|███████▉  | 79/100 [00:26<00:06,  3.49it/s]get samples for each class:  80%|████████  | 80/100 [00:26<00:06,  3.33it/s]get samples for each class:  81%|████████  | 81/100 [00:26<00:05,  3.64it/s]get samples for each class:  82%|████████▏ | 82/100 [00:27<00:05,  3.45it/s]get samples for each class:  83%|████████▎ | 83/100 [00:27<00:05,  3.24it/s]get samples for each class:  84%|████████▍ | 84/100 [00:27<00:05,  3.07it/s]get samples for each class:  85%|████████▌ | 85/100 [00:28<00:05,  2.96it/s]get samples for each class:  86%|████████▌ | 86/100 [00:28<00:04,  2.93it/s]get samples for each class:  87%|████████▋ | 87/100 [00:28<00:04,  2.96it/s]get samples for each class:  88%|████████▊ | 88/100 [00:29<00:03,  3.02it/s]get samples for each class:  89%|████████▉ | 89/100 [00:29<00:03,  3.05it/s]get samples for each class:  90%|█████████ | 90/100 [00:29<00:03,  3.12it/s]get samples for each class:  91%|█████████ | 91/100 [00:30<00:02,  3.09it/s]get samples for each class:  92%|█████████▏| 92/100 [00:30<00:02,  3.16it/s]get samples for each class:  93%|█████████▎| 93/100 [00:30<00:02,  2.88it/s]get samples for each class:  94%|█████████▍| 94/100 [00:31<00:02,  2.96it/s]get samples for each class:  95%|█████████▌| 95/100 [00:31<00:01,  3.18it/s]get samples for each class:  96%|█████████▌| 96/100 [00:31<00:01,  3.24it/s]get samples for each class:  97%|█████████▋| 97/100 [00:32<00:00,  3.05it/s]get samples for each class:  98%|█████████▊| 98/100 [00:32<00:00,  3.05it/s]get samples for each class:  99%|█████████▉| 99/100 [00:32<00:00,  3.10it/s]get samples for each class: 100%|██████████| 100/100 [00:33<00:00,  2.86it/s]get samples for each class: 100%|██████████| 100/100 [00:33<00:00,  3.01it/s]
Support set size: 1000, Sample pool size: 10000
Preprocess Supporting set...:   0%|          | 0/1000 [00:00<?, ?it/s]Preprocess Supporting set...: 100%|██████████| 1000/1000 [00:00<00:00, 435862.41it/s]
Get the value of every sample in support set
Using sample pool to update the support set:   0%|          | 0/10000 [00:00<?, ?it/s]Using sample pool to update the support set:   4%|▍         | 387/10000 [00:00<00:02, 3866.80it/s]Using sample pool to update the support set:   9%|▊         | 863/10000 [00:00<00:02, 4390.08it/s]Using sample pool to update the support set:  13%|█▎        | 1333/10000 [00:00<00:01, 4530.13it/s]Using sample pool to update the support set:  18%|█▊        | 1787/10000 [00:00<00:01, 4528.95it/s]Using sample pool to update the support set:  22%|██▏       | 2240/10000 [00:00<00:01, 4501.37it/s]Using sample pool to update the support set:  27%|██▋       | 2693/10000 [00:00<00:01, 4508.93it/s]Using sample pool to update the support set:  31%|███▏      | 3144/10000 [00:00<00:01, 4476.73it/s]Using sample pool to update the support set:  36%|███▌      | 3592/10000 [00:00<00:01, 4436.08it/s]Using sample pool to update the support set:  40%|████      | 4036/10000 [00:00<00:01, 4367.02it/s]Using sample pool to update the support set:  45%|████▍     | 4473/10000 [00:01<00:01, 4314.47it/s]Using sample pool to update the support set:  49%|████▉     | 4905/10000 [00:01<00:01, 4249.30it/s]Using sample pool to update the support set:  53%|█████▎    | 5331/10000 [00:01<00:01, 4210.95it/s]Using sample pool to update the support set:  58%|█████▊    | 5753/10000 [00:01<00:01, 4162.65it/s]Using sample pool to update the support set:  62%|██████▏   | 6170/10000 [00:01<00:00, 4104.69it/s]Using sample pool to update the support set:  66%|██████▌   | 6581/10000 [00:01<00:00, 4037.63it/s]Using sample pool to update the support set:  70%|██████▉   | 6985/10000 [00:01<00:00, 3977.60it/s]Using sample pool to update the support set:  74%|███████▍  | 7383/10000 [00:01<00:00, 3929.27it/s]Using sample pool to update the support set:  78%|███████▊  | 7777/10000 [00:01<00:00, 3895.32it/s]Using sample pool to update the support set:  82%|████████▏ | 8167/10000 [00:01<00:00, 3847.50it/s]Using sample pool to update the support set:  86%|████████▌ | 8552/10000 [00:02<00:00, 3807.61it/s]Using sample pool to update the support set:  89%|████████▉ | 8933/10000 [00:02<00:00, 3771.31it/s]Using sample pool to update the support set:  93%|█████████▎| 9312/10000 [00:02<00:00, 3776.08it/s]Using sample pool to update the support set:  97%|█████████▋| 9692/10000 [00:02<00:00, 3781.85it/s]Successfully update the support set with sample pool, now support set size: 1000
Inference using the latest supporting set...

Inference ImageNet...:   0%|          | 0/5000 [00:00<?, ?it/s][A
Inference ImageNet...:   0%|          | 1/5000 [00:02<3:02:16,  2.19s/it][A
Inference ImageNet...:   0%|          | 2/5000 [00:03<1:56:19,  1.40s/it][A
Inference ImageNet...:   0%|          | 3/5000 [00:04<1:41:26,  1.22s/it][A
Inference ImageNet...:   0%|          | 4/5000 [00:04<1:19:50,  1.04it/s][A
Inference ImageNet...:   0%|          | 5/5000 [00:05<1:27:19,  1.05s/it][A
Inference ImageNet...:   0%|          | 6/5000 [00:07<1:31:51,  1.10s/it][A
Inference ImageNet...:   0%|          | 7/5000 [00:07<1:23:05,  1.00it/s][A
Inference ImageNet...:   0%|          | 8/5000 [00:08<1:20:36,  1.03it/s][A
Inference ImageNet...:   0%|          | 9/5000 [00:10<1:41:44,  1.22s/it][A
Inference ImageNet...:   0%|          | 10/5000 [00:11<1:47:22,  1.29s/it][A
Inference ImageNet...:   0%|          | 11/5000 [00:12<1:30:33,  1.09s/it][AUsing sample pool to update the support set: 100%|██████████| 10000/10000 [00:15<00:00, 3781.85it/s]
Inference ImageNet...:   0%|          | 12/5000 [00:15<2:15:09,  1.63s/it][A
Inference ImageNet...:   0%|          | 13/5000 [00:16<2:10:25,  1.57s/it][A
Inference ImageNet...:   0%|          | 14/5000 [00:17<1:47:51,  1.30s/it][A
Inference ImageNet...:   0%|          | 15/5000 [00:18<1:31:47,  1.10s/it][A
Inference ImageNet...:   0%|          | 16/5000 [00:19<1:35:54,  1.15s/it][A
Inference ImageNet...:   0%|          | 17/5000 [00:20<1:21:05,  1.02it/s][A
Inference ImageNet...:   0%|          | 18/5000 [00:22<1:56:37,  1.40s/it][A
Inference ImageNet...:   0%|          | 19/5000 [00:23<1:58:47,  1.43s/it][A
Inference ImageNet...:   0%|          | 20/5000 [00:25<1:52:14,  1.35s/it][A
Inference ImageNet...:   0%|          | 21/5000 [00:26<1:48:56,  1.31s/it][A
Inference ImageNet...:   0%|          | 22/5000 [00:26<1:30:57,  1.10s/it][A
Inference ImageNet...:   0%|          | 23/5000 [00:28<1:33:43,  1.13s/it][A
Inference ImageNet...:   0%|          | 24/5000 [00:28<1:21:23,  1.02it/s][A
Inference ImageNet...:   0%|          | 25/5000 [00:29<1:27:22,  1.05s/it][A
Inference ImageNet...:   1%|          | 26/5000 [00:32<1:58:30,  1.43s/it][A
Inference ImageNet...:   1%|          | 27/5000 [00:33<1:53:19,  1.37s/it][A
Inference ImageNet...:   1%|          | 28/5000 [00:35<2:17:32,  1.66s/it][A
Inference ImageNet...:   1%|          | 29/5000 [00:36<1:51:09,  1.34s/it][A
Inference ImageNet...:   1%|          | 30/5000 [00:37<1:32:33,  1.12s/it][A
Inference ImageNet...:   1%|          | 31/5000 [00:38<1:38:48,  1.19s/it][A
Inference ImageNet...:   1%|          | 32/5000 [00:39<1:39:19,  1.20s/it][A
Inference ImageNet...:   1%|          | 33/5000 [00:40<1:38:45,  1.19s/it][A
Inference ImageNet...:   1%|          | 34/5000 [00:42<1:47:49,  1.30s/it][A
Inference ImageNet...:   1%|          | 35/5000 [00:44<1:57:39,  1.42s/it][A
Inference ImageNet...:   1%|          | 36/5000 [00:45<1:55:53,  1.40s/it][A
Inference ImageNet...:   1%|          | 37/5000 [00:46<1:50:30,  1.34s/it][A
Inference ImageNet...:   1%|          | 38/5000 [00:47<1:47:50,  1.30s/it][A
Inference ImageNet...:   1%|          | 39/5000 [00:48<1:44:21,  1.26s/it][A
Inference ImageNet...:   1%|          | 40/5000 [00:51<2:10:11,  1.57s/it][A
Inference ImageNet...:   1%|          | 41/5000 [00:51<1:46:18,  1.29s/it][A
Inference ImageNet...:   1%|          | 42/5000 [00:53<1:44:14,  1.26s/it][A
Inference ImageNet...:   1%|          | 43/5000 [00:54<1:43:01,  1.25s/it][A
Inference ImageNet...:   1%|          | 44/5000 [00:55<1:43:25,  1.25s/it][A
Inference ImageNet...:   1%|          | 45/5000 [00:57<1:51:19,  1.35s/it][A
Inference ImageNet...:   1%|          | 46/5000 [00:57<1:34:02,  1.14s/it][A
Inference ImageNet...:   1%|          | 47/5000 [00:59<1:35:52,  1.16s/it][A
Inference ImageNet...:   1%|          | 48/5000 [01:00<1:37:20,  1.18s/it][A
Inference ImageNet...:   1%|          | 49/5000 [01:00<1:23:07,  1.01s/it][A
Inference ImageNet...:   1%|          | 50/5000 [01:02<1:28:09,  1.07s/it][A
Inference ImageNet...:   1%|          | 51/5000 [01:03<1:31:51,  1.11s/it][A
Inference ImageNet...:   1%|          | 52/5000 [01:04<1:28:36,  1.07s/it][A
Inference ImageNet...:   1%|          | 53/5000 [01:04<1:17:33,  1.06it/s][A
Inference ImageNet...:   1%|          | 54/5000 [01:06<1:26:23,  1.05s/it][A
Inference ImageNet...:   1%|          | 55/5000 [01:07<1:28:54,  1.08s/it][A
Inference ImageNet...:   1%|          | 56/5000 [01:10<2:10:54,  1.59s/it][A
Inference ImageNet...:   1%|          | 57/5000 [01:11<1:59:10,  1.45s/it][A
Inference ImageNet...:   1%|          | 58/5000 [01:12<1:53:33,  1.38s/it][A
Inference ImageNet...:   1%|          | 59/5000 [01:13<1:46:50,  1.30s/it][A
Inference ImageNet...:   1%|          | 60/5000 [01:14<1:44:53,  1.27s/it][A
Inference ImageNet...:   1%|          | 61/5000 [01:15<1:43:36,  1.26s/it][A
Inference ImageNet...:   1%|          | 62/5000 [01:16<1:27:17,  1.06s/it][A
Inference ImageNet...:   1%|▏         | 63/5000 [01:17<1:16:55,  1.07it/s][A
Inference ImageNet...:   1%|▏         | 64/5000 [01:19<1:51:21,  1.35s/it][A
Inference ImageNet...:   1%|▏         | 65/5000 [01:20<1:48:03,  1.31s/it][A
Inference ImageNet...:   1%|▏         | 66/5000 [01:22<1:51:43,  1.36s/it][A
Inference ImageNet...:   1%|▏         | 67/5000 [01:23<1:48:13,  1.32s/it][A
Inference ImageNet...:   1%|▏         | 68/5000 [01:24<1:34:12,  1.15s/it][A
Inference ImageNet...:   1%|▏         | 69/5000 [01:25<1:34:21,  1.15s/it][A
Inference ImageNet...:   1%|▏         | 70/5000 [01:26<1:39:36,  1.21s/it][A
Inference ImageNet...:   1%|▏         | 71/5000 [01:28<2:04:29,  1.52s/it][A
Inference ImageNet...:   1%|▏         | 72/5000 [01:30<1:55:48,  1.41s/it][A
Inference ImageNet...:   1%|▏         | 73/5000 [01:31<1:50:54,  1.35s/it][A
Inference ImageNet...:   1%|▏         | 74/5000 [01:34<2:26:39,  1.79s/it][A
Inference ImageNet...:   2%|▏         | 75/5000 [01:35<2:15:31,  1.65s/it][A
Inference ImageNet...:   2%|▏         | 76/5000 [01:36<1:51:17,  1.36s/it][A
Inference ImageNet...:   2%|▏         | 77/5000 [01:37<1:47:45,  1.31s/it][A
Inference ImageNet...:   2%|▏         | 78/5000 [01:38<1:45:22,  1.28s/it][A
Inference ImageNet...:   2%|▏         | 79/5000 [01:40<1:52:06,  1.37s/it][A
Inference ImageNet...:   2%|▏         | 80/5000 [01:42<2:15:24,  1.65s/it][A
Inference ImageNet...:   2%|▏         | 81/5000 [01:43<1:51:15,  1.36s/it][A
Inference ImageNet...:   2%|▏         | 82/5000 [01:45<2:25:25,  1.77s/it][A
Inference ImageNet...:   2%|▏         | 83/5000 [01:46<1:55:44,  1.41s/it][A
Inference ImageNet...:   2%|▏         | 84/5000 [01:48<2:14:54,  1.65s/it][A
Inference ImageNet...:   2%|▏         | 85/5000 [01:49<1:48:18,  1.32s/it][A
Inference ImageNet...:   2%|▏         | 86/5000 [01:49<1:35:35,  1.17s/it][A
Inference ImageNet...:   2%|▏         | 87/5000 [01:50<1:25:15,  1.04s/it][A
Inference ImageNet...:   2%|▏         | 88/5000 [01:51<1:26:16,  1.05s/it][A
Inference ImageNet...:   2%|▏         | 89/5000 [01:52<1:23:50,  1.02s/it][A
Inference ImageNet...:   2%|▏         | 90/5000 [01:53<1:28:33,  1.08s/it][A
Inference ImageNet...:   2%|▏         | 91/5000 [01:55<1:31:48,  1.12s/it][A
Inference ImageNet...:   2%|▏         | 92/5000 [01:56<1:34:12,  1.15s/it][A
Inference ImageNet...:   2%|▏         | 93/5000 [01:57<1:39:12,  1.21s/it][A
Inference ImageNet...:   2%|▏         | 94/5000 [01:59<1:39:35,  1.22s/it][A
Inference ImageNet...:   2%|▏         | 95/5000 [02:01<2:06:01,  1.54s/it][A
Inference ImageNet...:   2%|▏         | 96/5000 [02:02<2:00:54,  1.48s/it][A
Inference ImageNet...:   2%|▏         | 97/5000 [02:03<1:41:05,  1.24s/it][A
Inference ImageNet...:   2%|▏         | 98/5000 [02:04<1:43:55,  1.27s/it][A
Inference ImageNet...:   2%|▏         | 99/5000 [02:05<1:42:31,  1.26s/it][A
Inference ImageNet...:   2%|▏         | 100/5000 [02:07<1:42:56,  1.26s/it][A
Inference ImageNet...:   2%|▏         | 101/5000 [02:08<1:44:52,  1.28s/it][A
Inference ImageNet...:   2%|▏         | 102/5000 [02:09<1:43:24,  1.27s/it][A
Inference ImageNet...:   2%|▏         | 103/5000 [02:10<1:27:56,  1.08s/it][A
Inference ImageNet...:   2%|▏         | 104/5000 [02:11<1:28:36,  1.09s/it][A
Inference ImageNet...:   2%|▏         | 105/5000 [02:12<1:29:54,  1.10s/it][A
Inference ImageNet...:   2%|▏         | 106/5000 [02:13<1:36:27,  1.18s/it][A
Inference ImageNet...:   2%|▏         | 107/5000 [02:15<1:37:20,  1.19s/it][A
Inference ImageNet...:   2%|▏         | 108/5000 [02:16<1:29:20,  1.10s/it][A
Inference ImageNet...:   2%|▏         | 109/5000 [02:18<1:59:20,  1.46s/it][A
Inference ImageNet...:   2%|▏         | 110/5000 [02:18<1:37:59,  1.20s/it][A
Inference ImageNet...:   2%|▏         | 111/5000 [02:20<1:40:35,  1.23s/it][A
Inference ImageNet...:   2%|▏         | 112/5000 [02:21<1:31:46,  1.13s/it][A
Inference ImageNet...:   2%|▏         | 113/5000 [02:21<1:18:05,  1.04it/s][A
Inference ImageNet...:   2%|▏         | 114/5000 [02:24<1:52:34,  1.38s/it][A
Inference ImageNet...:   2%|▏         | 115/5000 [02:24<1:34:35,  1.16s/it][A
Inference ImageNet...:   2%|▏         | 116/5000 [02:25<1:34:50,  1.17s/it][A
Inference ImageNet...:   2%|▏         | 117/5000 [02:26<1:19:32,  1.02it/s][A
Inference ImageNet...:   2%|▏         | 118/5000 [02:27<1:20:34,  1.01it/s][A
Inference ImageNet...:   2%|▏         | 119/5000 [02:28<1:30:02,  1.11s/it][A
Inference ImageNet...:   2%|▏         | 120/5000 [02:30<1:33:38,  1.15s/it][A
Inference ImageNet...:   2%|▏         | 121/5000 [02:31<1:34:30,  1.16s/it][A
Inference ImageNet...:   2%|▏         | 122/5000 [02:34<2:13:57,  1.65s/it][A
Inference ImageNet...:   2%|▏         | 123/5000 [02:35<2:00:55,  1.49s/it][A
Inference ImageNet...:   2%|▏         | 124/5000 [02:35<1:42:48,  1.27s/it][A
Inference ImageNet...:   2%|▎         | 125/5000 [02:37<1:41:34,  1.25s/it][A
Inference ImageNet...:   3%|▎         | 126/5000 [02:38<1:44:15,  1.28s/it][A
Inference ImageNet...:   3%|▎         | 127/5000 [02:39<1:47:00,  1.32s/it][A
Inference ImageNet...:   3%|▎         | 128/5000 [02:41<1:44:33,  1.29s/it][A
Inference ImageNet...:   3%|▎         | 129/5000 [02:41<1:34:21,  1.16s/it][A
Inference ImageNet...:   3%|▎         | 130/5000 [02:42<1:20:35,  1.01it/s][A
Inference ImageNet...:   3%|▎         | 131/5000 [02:43<1:25:29,  1.05s/it][A
Inference ImageNet...:   3%|▎         | 132/5000 [02:44<1:29:09,  1.10s/it][A
Inference ImageNet...:   3%|▎         | 133/5000 [02:45<1:19:37,  1.02it/s][A
Inference ImageNet...:   3%|▎         | 134/5000 [02:46<1:11:08,  1.14it/s][A
Inference ImageNet...:   3%|▎         | 135/5000 [02:48<1:45:41,  1.30s/it][A
Inference ImageNet...:   3%|▎         | 136/5000 [02:50<1:47:21,  1.32s/it][A
Inference ImageNet...:   3%|▎         | 137/5000 [02:51<1:55:24,  1.42s/it][A
Inference ImageNet...:   3%|▎         | 138/5000 [02:53<1:53:49,  1.40s/it][AInference ImageNet...:   3%|▎         | 138/5000 [02:53<1:41:50,  1.26s/it]
Traceback (most recent call last):
  File "/data/chy/online/ImageNet/main.py", line 91, in <module>
    results, predictions = inferencer.run()
  File "/data/chy/online/ImageNet/inferencers.py", line 596, in run
    self.inference_batch(batch_samples)
  File "/data/chy/online/ImageNet/inferencers.py", line 421, in inference_batch
    self.evaluate_batch_on_idev2(batch_samples)
  File "/data/chy/online/ImageNet/inferencers.py", line 382, in evaluate_batch_on_idev2
    outputs = self.model.generate(**inputs, bad_words_ids=BAD_WORDS_IDS,min_new_tokens=1, max_new_tokens=20,num_beams=1,
  File "/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/transformers/generation/utils.py", line 2215, in generate
    result = self._sample(
  File "/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/transformers/generation/utils.py", line 3206, in _sample
    outputs = self(**model_inputs, return_dict=True)
  File "/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/accelerate/hooks.py", line 170, in new_forward
    output = module._old_forward(*args, **kwargs)
  File "/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/transformers/models/idefics2/modeling_idefics2.py", line 1624, in forward
    outputs = self.model(
  File "/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/transformers/models/idefics2/modeling_idefics2.py", line 1423, in forward
    image_hidden_states = self.vision_model(
  File "/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/accelerate/hooks.py", line 170, in new_forward
    output = module._old_forward(*args, **kwargs)
  File "/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/transformers/models/idefics2/modeling_idefics2.py", line 706, in forward
    encoder_outputs = self.encoder(
  File "/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/accelerate/hooks.py", line 170, in new_forward
    output = module._old_forward(*args, **kwargs)
  File "/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/transformers/models/idefics2/modeling_idefics2.py", line 554, in forward
    layer_outputs = encoder_layer(
  File "/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/accelerate/hooks.py", line 170, in new_forward
    output = module._old_forward(*args, **kwargs)
  File "/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/transformers/models/idefics2/modeling_idefics2.py", line 466, in forward
    hidden_states, attn_weights = self.self_attn(
  File "/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/accelerate/hooks.py", line 170, in new_forward
    output = module._old_forward(*args, **kwargs)
  File "/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/transformers/models/idefics2/modeling_idefics2.py", line 250, in forward
    attn_weights = nn.functional.softmax(attn_weights, dim=-1, dtype=torch.float32).to(query_states.dtype)
  File "/home/chy63/.conda/envs/openflamingo/lib/python3.9/site-packages/torch/nn/functional.py", line 1845, in softmax
    ret = input.softmax(dim, dtype=dtype)
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 7.16 GiB (GPU 0; 23.68 GiB total capacity; 15.02 GiB already allocated; 6.00 GiB free; 17.36 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF
Using sample pool to update the support set: 100%|██████████| 10000/10000 [02:56<00:00, 56.61it/s]  
